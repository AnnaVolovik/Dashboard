<!DOCTYPE html>
<title>Main metrics</title>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/JSXTransformer.js"></script>
<body id='here'>
</body>

<script type="text/jsx">

    class Group14 extends React.Component {

        render () {
            return (
                <div className="group14">
                    <div className="circle_wrapper"><div className="circle green"></div></div>
                    <div className="text_wrapper">
                        <h2>{this.props.name}: {this.props.value}%</h2>
                        <p className="grey"><br />Average: {this.props.average}%</p>
                    </div>
                </div>);
            }
        }

    class Group10 extends React.Component {

        render () {
            const drawErrors = this.props.errors.map((error) =>
                <div className="square" style={error.style}></div>
            );
            const listErrors = this.props.errors.map((error) =>
                <div className="wrapper">
                    <div className="circle_wrapper"><div className={`square_rounded ${error.color}`}></div></div>
                    <div className="text_wrapper"><p>{error.code}: {error.count}</p></div>
                </div>
            );
            return (
                <div className="group12">{drawErrors}{listErrors}</div>
            );
        }
    }

    class ArrowShape extends React.Component {
        render () {
            return (
                <div className='t'><svg width="10" height="69" viewBox="0 0 10 69" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path opacity="0.220392" fill-rule="evenodd" clip-rule="evenodd" fill="url(#paint0_linear)"
                    d="M9.24585 0.170425C8.0191 0.325882 6.76892 0.405998 5.5 0.405998C3.82874 0.405998 2.18994 0.267021 0.594543 0L3.84613 63.406H0L4.5 68.406L9 63.406H5.19232L9.24585 0.170425Z" />
                    <defs>
                        <linearGradient id="paint0_linear" x1="9.24587" y1="68.406" x2="9.24587" y2="0" gradientUnits="userSpaceOnUse">
                            <stop stopColor="#2196F3"/>
                            <stop offset="1" stopColor="#A9D9FF"/>
                        </linearGradient>
                    </defs>
                </svg></div>
            )
        }
    }

    class Group18 extends React.Component {

        render () {
            const helpLinks = this.props.helpItems.map((helpItem) =>
                <a href="#">{helpItem}</a>).reduce((prev, curr) => [prev, ', ', curr]);

            const headingsSorted = this.props.headings.map((heading) =>
                <h2>{heading}</h2>).reduce((prev, curr) => [prev, <br />, curr]);

            return (
                <div className="group18">
                  <div className="text_wrapper">
                    <p>{headingsSorted}</p>
                    <p className="grey"><br />{this.props.description}</p>
                    <p><br />Help: {helpLinks} </p>
                  </div>
                </div>
            );
        }
    }

    class Group20 extends React.Component {
        render () {
            return (
                <div className="group20">
                    <div className="t_con">
                        <div className='t'>
                            <div className="t_shape">
                                <svg width={this.props.width} height={this.props.height} viewBox={this.props.viewBox} fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d={this.props.path} fill="white"/></svg>
                                <div className={`t_circle ${this.props.color}`}></div>
                            </div>
                        </div>
                        <ArrowShape />
                    </div>
                    <div className="text_wrapper">
                      <h2>{this.props.keyword}</h2><div className={`emphasized ${this.props.color}`}><span>{this.props.diff}%</span></div>
                      <p><br />{this.props.current} {this.props.day}</p>
                      <p className="grey"><br />{this.props.previous} Last Friday</p>
                    </div>
                </div>
            );
        }
    }

    class Group6 extends React.Component {
        render () {
            return (
                <div className='group6'>
                    <Group20 keyword={this.props.name} current={this.props.current} previous={this.props.previous} day={this.props.day} width={this.props.width} height={this.props.height} viewBox={this.props.viewBox} path={this.props.path} color={this.props.color} diff={this.props.diff}/>
                    <Group18 helpItems={this.props.helpItems} description={this.props.description} headings={this.props.headings}/>
                </div>
            );
        }
    }

    class NavButton extends React.Component {
        render(i) {
            return <a className={this.props.className} onClick={() => this.props.onClick(i)}>{this.props.name}</a>
        }
    }

    class App extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                menu_items: ["Last hour", "Today", "Yesterday", "Last 3 days"],
                menu_stats: ['last_hour', 'today', 'yesterday', 'last_3days'],
                full_statistics: {{stats | tojson }},
                stats: {{stats.yesterday | tojson}},
                focused: 2,
                sShape: {width: "16", height: "18", viewBox: "0 0 16 18", path: "M15.8719 0.597C15.6836 0.22875 15.3178 0 14.9156 0H1.08284C0.68139 0 0.314845 0.22875 0.126481 0.597C-0.0633372 0.969 -0.0378827 1.4145 0.191936 1.76025L5.75266 10.1453C5.79484 10.209 5.81739 10.2825 5.81739 10.359V16.8757C5.81739 17.496 6.30684 18 6.9083 18C7.10394 18 7.29666 17.9445 7.46757 17.8388L9.65303 16.4865C9.97884 16.284 10.181 15.915 10.181 15.5235V10.359C10.181 10.2825 10.2036 10.209 10.2465  10.1445L15.8065 1.761C16.0363 1.41525 16.0618 0.969 15.8719 0.597Z"},
                cShape: {width: "15", height: "21", viewBox: "0 0 15 21", path: "M4.25 4.5V8.24001C3.03998 7.42999 2.25 6.06 2.25 4.5C2.25 2.00999 4.26001 0 6.75 0C9.23999 0 11.25 2.00999 11.25 4.5C11.25 6.06 10.46 7.42999 9.25 8.24001V4.5C9.25 3.12 8.13 2 6.75 2C5.37 2 4.25 3.12 4.25 4.5ZM9.54999 10.61L14.09 12.87C14.62 13.09 15 13.63 15 14.25C15 14.31 14.99 14.38 14.98 14.45L14.23 19.72C14.12 20.45 13.54 21 12.79 21H6C5.59003 21 5.21002 20.83 4.94 20.56L0 15.62L0.789978 14.82C0.98999 14.62 1.27002 14.49 1.58002 14.49C1.64001 14.49 1.69116 14.4989 1.74231 14.5078C1.76782 14.5122 1.79333 14.5167 1.82001 14.52L5.25 15.24V4.5C5.25 3.67 5.91998 3 6.75 3C7.58002 3 8.25 3.67 8.25 4.5V10.5H9.01001C9.20001 10.5 9.38 10.54 9.54999 10.61Z"},
                bShape: {width: "20", height: "20", viewBox: "0 0 20 20", path: "M0 0V2H2L5.59497 9.58499L4.245 12.035C4.09003 12.325 4 12.65 4 13C4 14.105 4.89502 15 6 15H18V13H6.42499C6.28497 13 6.17499 12.89 6.17499 12.75C6.17499 12.705 6.185 12.665 6.20502 12.63L7.09998 11H14.55C15.3 11 15.955 10.585 16.3 9.97L19.875 3.48001C19.955 3.34 20 3.17499 20 3C20 2.44501 19.55 2 19 2H4.21503L3.26501 0H0ZM6 16C4.89502 16 4.01001 16.895 4.01001 18C4.01001 19.105 4.89502 20 6 20C7.10498 20 8 19.105 8 18C8 16.895 7.10498 16 6 16ZM14.01 18C14.01 16.895 14.895 16 16 16C17.105 16 18 16.895 18 18C18 19.105 17.105 20 16 20C14.895 20 14.01 19.105 14.01 18Z"}
            }
        }
        handleClick(i) {
            this.setState({
                focused: i,
                stats: this.state.full_statistics[this.state.menu_stats[i]]});
        }
        renderNavLink(i) {
            var className = '';
            if (i == this.state.focused) {
                className = "active";
            }
            return (
                <NavButton name={this.state.menu_items[i]}
                    onClick={() => this.handleClick(i)}
                    className={className}
                /> );
        }
        render () {
            var traffic = this.state.stats.searches.mobile + this.state.stats.searches.web
            const sDetails = {helpItems: ["Searches", "Pessimisation"],
                              description: "You get " + traffic +"% traffic on mobile and desktop devices.",
                              headings: ["Mobile traffic: " + this.state.stats.searches.mobile+"%",
                                         "Web traffic: "+ this.state.stats.searches.web +"%"]}
            const cDetails = {helpItems: ["CTR", "Clicks"],
                              description: 'Conversion from searches to clicks on all devices.',
                              headings: ["CTR: "+this.state.stats.clicks.ctr+"%"]}
            const bDetails = {helpItems: ["STR", "Bookings", "Avg. Check"],
                              description: 'Conversion from clicks to bookings on all devices.',
                              headings: ["STR: " + this.state.stats.bookings.str+"%",
                                         "Avg. Check: " + this.state.stats.bookings.avg_check]}
            const navs = []
            for (let i = 0; i < 4; i++) {
                navs.push(this.renderNavLink(i))
            }
            var top_stats = this.state.stats.top_statistics;
            var keys = Object.keys(top_stats);
            var topStats = []
            for (var i = 0; i < keys.length; i++) {
                var key = (keys[i]) ;
                topStats.push(<Group14 name={top_stats[key].name} value={top_stats[key].value} average={top_stats[key].average} />)
            }

            return (<section>
                        <h1>Main metrics</h1>
                        <nav>{navs}</nav>
                        <div className="group12">
                            {topStats}
                            <Group10 errors={this.state.stats.top_errors}/>
                            <Group6  {...this.state.sShape} {...this.state.stats.searches} {...sDetails} color="green" day={this.state.menu_items[this.state.focused]}/>
                            <hr />
                            <Group6 {...this.state.cShape} {...this.state.stats.clicks} {...cDetails} color="red-background" day={this.state.menu_items[this.state.focused]} />
                            <hr />
                            <Group6 {...this.state.bShape} {...this.state.stats.bookings} {...bDetails} color="green" day={this.state.menu_items[this.state.focused]}/>
                        </div>
                    </section>
            )
        }
    }
    React.render(<App />, document.getElementById('here') );

</script>
</html>
